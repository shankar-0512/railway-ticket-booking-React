{"ast":null,"code":"import _asyncToGenerator from\"D:/React JS/space-ticket-booking-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"D:/React JS/space-ticket-booking-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"D:\\\\React JS\\\\space-ticket-booking-app\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React from\"react\";import classes from\"./MyBooking.module.css\";import Layout from\"../layout/Layout\";import{useSelector}from\"react-redux\";import{useEffect,useState}from\"react\";import useHttp from\"../../hooks/use-http\";import TicketList from\"./TicketList\";import Modal from\"../UI/Modal\";import Button from\"../UI/Button/Button\";import ticketClasses from\"../UI/Button/Button.module.css\";import LoadingSpinner from\"../UI/LoadingSpinner\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ticketId=null;function MyBookings(){//************DECLARATIONS************//\nvar userEmail=useSelector(function(state){return state.login.userId;});var _useHttp=useHttp(),bookingIsLoading=_useHttp.isLoading,bookingError=_useHttp.error,sendBookingRequest=_useHttp.sendRequest,bookingResponse=_useHttp.response,resetBookingResponse=_useHttp.resetError,resetBookingError=_useHttp.resetResponse;var _useHttp2=useHttp(),cancelIsLoading=_useHttp2.isLoading,cancelError=_useHttp2.error,sendCancelRequest=_useHttp2.sendRequest,cancelResponse=_useHttp2.response,resetCancelError=_useHttp2.resetError,resetCancelResponse=_useHttp2.resetResponse;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),showCancellationPrompt=_useState2[0],setShowCancellationPrompt=_useState2[1];//************API CALLS************//\n//Request to backend for bookings data\nvar fetchBookingDetails=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(requestJson){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:sendBookingRequest({url:\"http://localhost:8080/api/protected/fetchBookingDetails\",method:\"post\",headers:{\"Content-Type\":\"application/json\"},body:{userEmail:requestJson.userEmail},errorMsg:\"Request failed!\"});case 1:case\"end\":return _context.stop();}}},_callee);}));return function fetchBookingDetails(_x){return _ref.apply(this,arguments);};}();//Request to backend for cancelling ticket\nvar cancelTicket=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(requestJson){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:sendCancelRequest({url:\"http://localhost:8080/api/protected/cancelTicket\",method:\"post\",headers:{\"Content-Type\":\"application/json\"},body:{bookingId:requestJson.ticketId},errorMsg:\"Request failed!\"});case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function cancelTicket(_x2){return _ref2.apply(this,arguments);};}();//************ACTION HANDLERS************//\nuseEffect(function(){var requestJson={userEmail:userEmail};fetchBookingDetails(requestJson);},[]);function onTicketCancelHandler(id){ticketId=id;setShowCancellationPrompt(true);}function cancellationHandler(){var requestJson={ticketId:ticketId};cancelTicket(requestJson);setShowCancellationPrompt(false);}function closeTicketCancelModal(){setShowCancellationPrompt(false);ticketId=null;}function recallFetchBooking(){var requestJson={userEmail:userEmail};fetchBookingDetails(requestJson);resetCancelResponse();resetCancelError();}//************MODALS************//\nvar ticketCancelModalActions=/*#__PURE__*/_jsxs(\"div\",{className:classes.actions,children:[/*#__PURE__*/_jsx(Button,{className:ticketClasses.button,onClick:cancellationHandler,children:\"Yes\"}),/*#__PURE__*/_jsx(Button,{className:ticketClasses.button,onClick:closeTicketCancelModal,children:\"No\"})]});var ticketCancelModalContent=/*#__PURE__*/_jsx(React.Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:classes.total,children:/*#__PURE__*/_jsx(\"span\",{children:\"ARE YOU SURE? REFUNDS CAN TAKE UP TO 5-7 DAYS.\"})})});var cancellationMessageActions=/*#__PURE__*/_jsx(\"div\",{className:classes.actions,children:/*#__PURE__*/_jsx(Button,{className:ticketClasses.button,onClick:recallFetchBooking,children:\"Close\"})});var cancellationMessageContent=/*#__PURE__*/_jsx(React.Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:classes.total,children:/*#__PURE__*/_jsx(\"span\",{children:cancelResponse.responseMessage})})});//************LOADING SPINNERS************//\nif(bookingIsLoading){return/*#__PURE__*/_jsx(\"div\",{className:\"centered\",children:/*#__PURE__*/_jsx(LoadingSpinner,{})});}if(cancelIsLoading){return/*#__PURE__*/_jsx(\"div\",{className:\"centered\",children:/*#__PURE__*/_jsx(LoadingSpinner,{})});}return/*#__PURE__*/_jsxs(Layout,{children:[showCancellationPrompt&&/*#__PURE__*/_jsxs(Modal,{children:[ticketCancelModalContent,ticketCancelModalActions]}),cancelResponse.responseCode===0&&/*#__PURE__*/_jsxs(Modal,{children:[cancellationMessageContent,cancellationMessageActions]}),/*#__PURE__*/_jsx(TicketList,{bookingList:bookingResponse,cancellationHandler:onTicketCancelHandler})]});}export default MyBookings;","map":{"version":3,"sources":["D:/React JS/space-ticket-booking-app/src/components/Ticket Booking/MyBookings.js"],"names":["React","classes","Layout","useSelector","useEffect","useState","useHttp","TicketList","Modal","Button","ticketClasses","LoadingSpinner","ticketId","MyBookings","userEmail","state","login","userId","bookingIsLoading","isLoading","bookingError","error","sendBookingRequest","sendRequest","bookingResponse","response","resetBookingResponse","resetError","resetBookingError","resetResponse","cancelIsLoading","cancelError","sendCancelRequest","cancelResponse","resetCancelError","resetCancelResponse","showCancellationPrompt","setShowCancellationPrompt","fetchBookingDetails","requestJson","url","method","headers","body","errorMsg","cancelTicket","bookingId","onTicketCancelHandler","id","cancellationHandler","closeTicketCancelModal","recallFetchBooking","ticketCancelModalActions","actions","button","ticketCancelModalContent","total","cancellationMessageActions","cancellationMessageContent","responseMessage","responseCode"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport classes from \"./MyBooking.module.css\";\r\nimport Layout from \"../layout/Layout\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { useEffect, useState } from \"react\";\r\nimport useHttp from \"../../hooks/use-http\";\r\nimport TicketList from \"./TicketList\";\r\nimport Modal from \"../UI/Modal\";\r\nimport Button from \"../UI/Button/Button\";\r\nimport ticketClasses from \"../UI/Button/Button.module.css\";\r\nimport LoadingSpinner from \"../UI/LoadingSpinner\";\r\n\r\nvar ticketId = null;\r\nfunction MyBookings() {\r\n\r\n  //************DECLARATIONS************//\r\n\r\n  const userEmail = useSelector((state) => state.login.userId);\r\n\r\n  const {\r\n    isLoading: bookingIsLoading,\r\n    error: bookingError,\r\n    sendRequest: sendBookingRequest,\r\n    response: bookingResponse,\r\n    resetError: resetBookingResponse,\r\n    resetResponse: resetBookingError,\r\n  } = useHttp();\r\n\r\n  const {\r\n    isLoading: cancelIsLoading,\r\n    error: cancelError,\r\n    sendRequest: sendCancelRequest,\r\n    response: cancelResponse,\r\n    resetError: resetCancelError,\r\n    resetResponse: resetCancelResponse,\r\n  } = useHttp();\r\n\r\n  const [showCancellationPrompt, setShowCancellationPrompt] = useState(false);\r\n\r\n  //************API CALLS************//\r\n\r\n  //Request to backend for bookings data\r\n  const fetchBookingDetails = async (requestJson) => {\r\n    sendBookingRequest({\r\n      url: \"http://localhost:8080/api/protected/fetchBookingDetails\",\r\n      method: \"post\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: {\r\n        userEmail: requestJson.userEmail,\r\n      },\r\n      errorMsg: \"Request failed!\",\r\n    });\r\n  };\r\n\r\n  //Request to backend for cancelling ticket\r\n  const cancelTicket = async (requestJson) => {\r\n    sendCancelRequest({\r\n      url: \"http://localhost:8080/api/protected/cancelTicket\",\r\n      method: \"post\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: {\r\n        bookingId: requestJson.ticketId,\r\n      },\r\n      errorMsg: \"Request failed!\",\r\n    });\r\n  };\r\n\r\n  //************ACTION HANDLERS************//\r\n\r\n  useEffect(() => {\r\n    const requestJson = { userEmail };\r\n    fetchBookingDetails(requestJson);\r\n  }, []);\r\n\r\n  function onTicketCancelHandler(id) {\r\n    ticketId = id;\r\n    setShowCancellationPrompt(true);\r\n  }\r\n\r\n  function cancellationHandler() {\r\n    const requestJson = {\r\n      ticketId,\r\n    };\r\n    cancelTicket(requestJson);\r\n    setShowCancellationPrompt(false);\r\n  }\r\n\r\n  function closeTicketCancelModal() {\r\n    setShowCancellationPrompt(false);\r\n    ticketId = null;\r\n  }\r\n\r\n  function recallFetchBooking() {\r\n    const requestJson = {\r\n      userEmail,\r\n    };\r\n    fetchBookingDetails(requestJson);\r\n    resetCancelResponse();\r\n    resetCancelError();\r\n  }\r\n\r\n  //************MODALS************//\r\n\r\n  const ticketCancelModalActions = (\r\n    <div className={classes.actions}>\r\n      <Button className={ticketClasses.button} onClick={cancellationHandler}>\r\n        Yes\r\n      </Button>\r\n      <Button className={ticketClasses.button} onClick={closeTicketCancelModal}>\r\n        No\r\n      </Button>\r\n    </div>\r\n  );\r\n\r\n  const ticketCancelModalContent = (\r\n    <React.Fragment>\r\n      <div className={classes.total}>\r\n        <span>ARE YOU SURE? REFUNDS CAN TAKE UP TO 5-7 DAYS.</span>\r\n      </div>\r\n    </React.Fragment>\r\n  );\r\n\r\n  const cancellationMessageActions = (\r\n    <div className={classes.actions}>\r\n      <Button className={ticketClasses.button} onClick={recallFetchBooking}>\r\n        Close\r\n      </Button>\r\n    </div>\r\n  );\r\n\r\n  const cancellationMessageContent = (\r\n    <React.Fragment>\r\n      <div className={classes.total}>\r\n        <span>{cancelResponse.responseMessage}</span>\r\n      </div>\r\n    </React.Fragment>\r\n  );\r\n\r\n  //************LOADING SPINNERS************//\r\n\r\n  if (bookingIsLoading) {\r\n    return (\r\n      <div className=\"centered\">\r\n        <LoadingSpinner />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (cancelIsLoading) {\r\n    return (\r\n      <div className=\"centered\">\r\n        <LoadingSpinner />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Layout>\r\n      {showCancellationPrompt && (\r\n        <Modal>\r\n          {ticketCancelModalContent}\r\n          {ticketCancelModalActions}\r\n        </Modal>\r\n      )}\r\n      {cancelResponse.responseCode === 0 && (\r\n        <Modal>\r\n          {cancellationMessageContent}\r\n          {cancellationMessageActions}\r\n        </Modal>\r\n      )}\r\n      <TicketList\r\n        bookingList={bookingResponse}\r\n        cancellationHandler={onTicketCancelHandler}\r\n      />\r\n    </Layout>\r\n  );\r\n}\r\nexport default MyBookings;\r\n"]},"metadata":{},"sourceType":"module"}